!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):n.flyd=e()}(this,function(){"use strict";var n=function(n,e){switch(n){case 0:return function(){return e.apply(this,arguments)};case 1:return function(n){return e.apply(this,arguments)};case 2:return function(n,t){return e.apply(this,arguments)};case 3:return function(n,t,r){return e.apply(this,arguments)};case 4:return function(n,t,r,u){return e.apply(this,arguments)};case 5:return function(n,t,r,u,a){return e.apply(this,arguments)};case 6:return function(n,t,r,u,a,i){return e.apply(this,arguments)};case 7:return function(n,t,r,u,a,i,o){return e.apply(this,arguments)};case 8:return function(n,t,r,u,a,i,o,s){return e.apply(this,arguments)};case 9:return function(n,t,r,u,a,i,o,s,f){return e.apply(this,arguments)};case 10:return function(n,t,r,u,a,i,o,s,f,d){return e.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}};var e=function(n){return null!=n&&"object"==typeof n&&!0===n["@@functional/placeholder"]};var t=function(n){return function t(r){return 0===arguments.length||e(r)?t:n.apply(this,arguments)}};var r=function t(r,u,a){return function(){for(var i=[],o=0,s=r,f=0;f<u.length||o<arguments.length;){var d;f<u.length&&(!e(u[f])||o>=arguments.length)?d=u[f]:(d=arguments[o],o+=1),i[f]=d,e(d)||(s-=1),f+=1}return s<=0?a.apply(this,i):n(s,t(r,i,a))}},u=function(n){return function r(u,a){switch(arguments.length){case 0:return r;case 1:return e(u)?r:t(function(e){return n(u,e)});default:return e(u)&&e(a)?r:e(u)?t(function(e){return n(e,a)}):e(a)?t(function(e){return n(u,e)}):n(u,a)}}}(function(e,u){return 1===e?t(u):n(e,r(e,[],u))});function a(){return!0}var i,o=[],s=[],f=-1,d=!1,c={};function p(n,e){var t,r,u,i,o=b([],a);for(u=[],i=[],t=0;t<e.length;++t)void 0!==e[t]&&(u.push(e[t]),void 0!==e[t].end&&i.push(e[t].end));return(r=b(u,n)).depsChanged=[],r.fnArgs=r.deps.concat([r,r.depsChanged]),r.end=o,o.listeners.push(r),U(i,o),o.deps=i,w(r),r}function l(n){return c.map(n,this)}function h(n){return n(this)}function v(n){return g(n,this)}function g(n,e){var t=c.stream(1),r=c.on(function(){var n=t()-1;t(n),n<=0&&t.end(!0)});r(e.end);var u=c.stream(),a=c.combine(function(e,a){u.end(!0);var i=n(e());t(t()+1),r(i.end),u=c.map(a,i)},[e]);return c.endsOn(t.end,a),a}function m(n,e){return p(function(n,e,t){t(n.val(e.val))},[e,n])}function y(n){return m(n,this)}function C(n){return m(this,n)}function V(){return"stream("+this.val+")"}function M(){function n(e){return 0===arguments.length?n.val:(function n(e,t){e.val=t;e.hasVal=!0;void 0===i?(d=!0,function(n){var e,t,r,u=n.listeners;for(e=0;e<u.length;++e)(r=u[e]).end===n?S(r):(void 0!==r.depsChanged&&r.depsChanged.push(n),r.shouldUpdate=!0,A(r));for(;f>=0;--f)!0===(t=s[f]).shouldUpdate&&w(t),t.queued=!1}(e),o.length>0?O():d=!1):i===e?function(n,e){var t,r;for(t=0;t<e.length;++t)(r=e[t]).end!==n?(void 0!==r.depsChanged&&r.depsChanged.push(n),r.shouldUpdate=!0):S(r)}(e,e.listeners):o.push(function(){n(e,t)})}(n,e),n)}return n.hasVal=!1,n.val=void 0,n.vals=[],n.listeners=[],n.queued=!1,n.end=void 0,n.ap=y,n["fantasy-land/map"]=n.map=l,n["fantasy-land/ap"]=C,n["fantasy-land/of"]=n.of=c.stream,n["fantasy-land/chain"]=n.chain=v,n.pipe=h,n.constructor=c.stream,n.toJSON=function(){return n.val},n.toString=V,n}function b(n,e){var t=M();return t.fn=e,t.deps=n,t.depsMet=!1,t.depsChanged=n.length>0?[]:void 0,t.shouldUpdate=!1,U(n,t),t}function w(n){var e;if(!(!0!==n.depsMet&&(e=n,e.depsMet=e.deps.every(function(n){return n.hasVal}),!e.depsMet)||void 0!==n.end&&!0===n.end.val))if(void 0===i){i=n,n.depsChanged&&(n.fnArgs[n.fnArgs.length-1]=n.depsChanged);var t=n.fn.apply(n.fn,n.fnArgs);void 0!==t&&n(t),i=void 0,void 0!==n.depsChanged&&(n.depsChanged=[]),n.shouldUpdate=!1,!1===d&&O()}else o.push(function(){w(n)})}function A(n){var e,t=n.listeners;if(!1===n.queued){for(n.queued=!0,e=0;e<t.length;++e)A(t[e]);s[++f]=n}}function O(){for(d=!0;o.length>0;){o.shift()()}d=!1}function U(n,e){for(var t=0;t<n.length;++t)n[t].listeners.push(e)}function q(n,e){e[e.indexOf(n)]=e[e.length-1],e.length--}function x(n){for(var e=0;e<n.deps.length;++e)q(n,n.deps[e].listeners);n.deps.length=0}function S(n){void 0!==n.deps&&x(n),void 0!==n.end&&x(n.end)}function j(){}return c.stream=function(n){var e=b([],a),t=M();return t.end=e,t.fnArgs=[],e.listeners.push(t),arguments.length>0&&t(n),t},c.stream["fantasy-land/of"]=c.stream.of=c.stream,c.combine=u(2,p),c.isStream=function(n){return!!((e=n)&&e.constructor&&e.call&&e.apply)&&"hasVal"in n;var e},c.immediate=function(n){return!1===n.depsMet&&(n.depsMet=!0,w(n)),n},c.endsOn=function(n,e){return x(e.end),n.listeners.push(e.end),e.end.deps.push(n),e},c.map=u(2,function(n,e){return p(function(e,t){t(n(e.val))},[e])}),c.chain=u(2,g),c.ap=u(2,m),c.on=u(2,function(n,e){return p(function(e){n(e.val)},[e])}),c.scan=u(3,function(n,e,t){var r=p(function(t,r){r(e=n(e,t.val))},[t]);return r.hasVal||r(e),r}),c.merge=u(2,function(n,e){var t=c.immediate(p(function(n,e,t,r){r[0]?t(r[0]()):n.hasVal?t(n.val):e.hasVal&&t(e.val)},[n,e]));return c.endsOn(p(function(){return!0},[n.end,e.end]),t),t}),c.transduce=u(2,function(n,e){return n=n(new j),p(function(e,t){var r=n["@@transducer/step"](void 0,e.val);return r&&!0===r["@@transducer/reduced"]?(t.end(!0),r["@@transducer/value"]):r},[e])}),c.curryN=u,c.fromPromise=function(n){var e=c.stream();return n.then(function(n){e(n),e.end(!0)}),e},c.flattenPromise=function(n){return p(function(n,e){n().then(e)},[n])},j.prototype["@@transducer/init"]=function(){},j.prototype["@@transducer/result"]=function(){},j.prototype["@@transducer/step"]=function(n,e){return e},c});
